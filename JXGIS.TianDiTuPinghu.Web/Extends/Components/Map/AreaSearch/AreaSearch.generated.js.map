{"version":3,"file":"E:\\工作\\Code\\07 天地图·平湖\\TianDiTu-PingHu - 副本\\JXGIS.TianDiTuPinghu.Web\\Extends\\Components\\Map\\AreaSearch\\AreaSearch.jsx","sourceRoot":null,"sources":["E:\\工作\\Code\\07 天地图·平湖\\TianDiTu-PingHu - 副本\\JXGIS.TianDiTuPinghu.Web\\Extends\\Components\\Map\\AreaSearch\\AreaSearch.jsx"],"sourcesContent":["class AreaSearch extends React.Component {\r\n    constructor(props) {\r\n        super();\r\n        var options = {\r\n            defaulteState: {\r\n                distance: 800,\r\n                searchText: ''\r\n            },\r\n            point: null\r\n        };\r\n        this.options = options;\r\n        this.state = options.defaulteState;\r\n    }\r\n\r\n    reset() {\r\n        var centerLayer = this.centerLayer;\r\n        var areaSearchLayer = this.areaSearchLayer;\r\n        this.popup = null;\r\n        if (centerLayer) {\r\n            centerLayer.remove();\r\n            centerLayer = null;\r\n        }\r\n        if (areaSearchLayer) {\r\n            areaSearchLayer.remove();\r\n            this.areaSearchLayer = null;\r\n        }\r\n        this.setState(this.defaulteState);\r\n    }\r\n\r\n    setPosition(point) {\r\n        this.options.point = point;\r\n    }\r\n\r\n    changeSearchText(text) {\r\n        this.setState({ searchText: text });\r\n    }\r\n\r\n    search() {\r\n        var map = this.props.map;\r\n        var point = this.options.point;\r\n        var radius = this.state.distance;\r\n        var searchText = this.state.searchText;\r\n        var categories = this.options.categories;\r\n        this.reset();\r\n\r\n        var areaSearchLayer = L.circle(point, { radius: radius, weight: 1 });\r\n        areaSearchLayer.editing.enable();\r\n        map.drawItems.addLayer(areaSearchLayer);\r\n        this.areaSearchLayer = areaSearchLayer;\r\n        map.areaSearchLayer = areaSearchLayer;\r\n\r\n        areaSearchLayer.on('edit', (function (cThis, point, searchText, categories) {\r\n            return function (e) {\r\n                var circle = e.target;\r\n                var radius = circle.getRadius();\r\n                var center = circle.getLatLng();\r\n                $('.leaflet-edit-resize').attr('data-distance', radius.toFixed(0) + '米');\r\n                cThis.getPOI(false, searchText, center, radius, categories);\r\n            }\r\n        })(this, point, searchText, categories));\r\n\r\n        $('.leaflet-edit-resize').attr('data-distance', radius.toFixed(0) + '米');\r\n\r\n        this.getPOI(false, searchText, point, radius, categories);\r\n    }\r\n\r\n    getPOI(fitMap, text, center, radius, categories) {\r\n        _g.resultsPanel.getPOI(fitMap, text, categories, 1, center, radius);\r\n        _g.resultsPanel.show();\r\n        _g.poiDetails.hidden();\r\n    }\r\n\r\n    render() {\r\n        var opts = this.options;\r\n        var state = this.state;\r\n        return (\r\n        <div className=\"areasearch\">\r\n            <h3>周边搜索</h3>\r\n            <div>\r\n                 <antd.Input.Group>\r\n                     <antd.Input placeholder=\"请输入关键字...\" value={state.searchText} onChange={e=>this.changeSearchText(e.target.value)} />\r\n                     <div className=\"ant-input-group-wrap\">\r\n                         <antd.Button type=\"primary\" onClick={this.search.bind(this)}>搜索</antd.Button>\r\n                     </div>\r\n                 </antd.Input.Group>\r\n            </div>\r\n            <div className=\"areasearch-btns\">\r\n                <antd.Button onClick={e=> { this.options.categories = [\"120201\", \"120202\", \"120204\", \"140312\", \"140310\", \"140311\"]; this.search(); }} type=\"primary\" size=\"small\">餐饮</antd.Button>\r\n                <antd.Button onClick={e=> { this.options.categories = [\"120101\", \"120102\", \"120103\"]; this.search(); }} type=\"primary\" size=\"small\">住宿</antd.Button>\r\n                <antd.Button onClick={e=> { this.options.categories = [\"160501\", \"160502\"]; this.search(); }} type=\"primary\" size=\"small\">银行</antd.Button>\r\n                <antd.Button onClick={e=> { this.options.categories = [\"170105\"]; this.search(); }} type=\"primary\" size=\"small\">公交站</antd.Button>\r\n                <antd.Button onClick={e=> { this.options.categories = [\"160301\", \"160302\", \"160303\", \"160304\", \"150406\"]; this.search(); }} type=\"primary\" size=\"small\">医院</antd.Button>\r\n            </div>\r\n        </div>\r\n        );\r\n    }\r\n}\r\n\r\nAreaSearch.create = function (map, layer, node) {\r\n\r\n    //单例，不存在则创建，存在则返回\r\n    if (!AreaSearch.instance) {\r\n        var dom = node || document.createElement('div');\r\n        var areaSearch = ReactDOM.render(<AreaSearch map={map } />, dom);\r\n        areaSearch.dom = dom;\r\n        AreaSearch.instance = areaSearch;\r\n    }\r\n    areaSearch = AreaSearch.instance;\r\n    areaSearch.reset();\r\n\r\n    areaSearch.setPosition(layer.getLatLng());\r\n    areaSearch.centerLayer = layer;\r\n    areaSearch.popup = layer.bindPopup(areaSearch.dom);\r\n\r\n    return AreaSearch.instance;\r\n}"],"names":[],"mappings":"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"}